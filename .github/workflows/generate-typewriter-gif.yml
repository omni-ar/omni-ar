name: Update README - daily quote

on:
  schedule:
    - cron: '0 8 * * *'  # runs daily at 08:00 UTC
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Get a daily quote
        id: quote
        run: |
          QUOTE=$(curl -s "https://api.quotable.io/random?maxLength=120" | jq -r '.content + " â€” " + .author')
          echo "quote<<EOF" >> $GITHUB_OUTPUT
          echo "$QUOTE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Replace placeholder in README
        run: |
          QUOTE="${{ steps.quote.outputs.quote }}"
          perl -0777 -pe "s/<!--QUOTE_START-->.*?<!--QUOTE_END-->/<!--QUOTE_START-->\n> $QUOTE\n\n<!--QUOTE_END-->/s" -i README.md

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          if ! git diff --quiet; then
            git add README.md
            git commit -m "chore: update daily quote"
            git push
          else
            echo "No changes to commit"
          fi
